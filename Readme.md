# Отчет
## "Часть 1:Разработка API для модели классификации изображений (Ермолаев Александр)"

### 2. Выбор и описание модели

**Выбранная модель:** ResNet50

**Обоснование выбора:**
- Предобученная модель на dataset ImageNet
- Способность распознавать 1000 различных категорий объектов
- Хороший баланс между точностью и производительностью
- Широкая поддержка в сообществе и хорошая документация

**Технические характеристики модели:**
- Архитектура: Residual Network с 50 слоями
- Размер входного изображения: 224×224 пикселей
- Количество классов: 1000
- Фреймворк: TensorFlow/Keras

### 3. Реализация системы

#### 3.1. Структура проекта

Спроектирована следующая файловая структура:
```
image-classification-api/
├── app/
│   ├── main.py              # Основное приложение FastAPI
│   ├── classifier.py        # Класс для работы с моделью
│   └── schemas.py           # Схемы данных Pydantic
├── tests/
│   └── test_api.py          # Тесты API
└── requirements.txt         # Зависимости проекта
```

#### 3.2. Ключевые компоненты реализации

**Класс ImageClassifier (classifier.py):**
- Инкапсулирует всю логику работы с моделью
- Реализует методы для загрузки изображений из файлов и URL
- Выполняет предобработку изображений (ресайз, нормализация)
- Обеспечивает взаимодействие с моделью ResNet50

**FastAPI приложение (main.py):**
- Реализует три основных эндпоинта:
  - `GET /health` - проверка состояния системы
  - `POST /predict` - классификация из файла
  - `POST /predict/url` - классификация из URL
- Обеспечивает валидацию входных данных
- Предоставляет автоматическую документацию Swagger

**Схемы данных (schemas.py):**
- Определяют структуру запросов и ответов
- Обеспечивают типобезопасность и валидацию
- Упрощают взаимодействие с API

### 4. Часть 2:Тестирование системы (Ермолаев Александр)

#### 4.1. Методы тестирования

**Модульное тестирование:**
- Проверка загрузки и инициализации модели
- Тестирование методов предобработки изображений
- Валидация форматов входных данных

**Интеграционное тестирование:**
```python
# Пример теста API
def test_predict_endpoint():
    with open("test_image.jpg", "rb") as f:
        response = client.post("/predict", files={"file": f})
    assert response.status_code == 200
    data = response.json()
    assert data["status"] == "success"
```

**Ручное тестирование через Swagger UI:**
- Тестирование всех эндпоинтов через интерактивную документацию
- Проверка обработки различных форматов изображений
- Тестирование граничных случаев и обработки ошибок

#### 4.2. Результаты тестирования

**Успешные сценарии:**
- Модель успешно загружается при старте приложения
- API корректно обрабатывает JPEG, PNG изображения
- Система возвращает топ-5 предсказаний с вероятностями
- Обработка изображений через URL работает стабильно

**Обработка ошибок:**
- Валидация не-image файлов
- Обработка битых изображений
- Таймауты при загрузке по URL
- Корректные HTTP статусы при ошибках


### 6. Возникшие трудности и их решение

#### 6.1. Проблема: Обработка различных форматов изображений
**Трудность:** Некорректная работа с некоторыми типами изображений
**Решение:** Добавление конвертации в RGB формат и улучшение обработки исключений

#### 6.2. Проблема: Производительность при множественных запросах
**Трудность:** Долгая обработка при одновременных запросах
**Решение:** Оптимизация пайплайна предобработки и использование асинхронности

### 7. Результаты работы

✅ Реализовано REST API с помощью FastAPI  
✅ Обеспечена поддержка загрузки изображений через файлы и URL  
✅ Реализована система тестирования и валидации  

### 8. Использованные технологии и библиотеки

- **Машинное обучение:** TensorFlow, Keras, ResNet50
- **Веб-фреймворк:** FastAPI
- **Обработка изображений:** Pillow, OpenCV
- **Валидация данных:** Pydantic
- **Тестирование:** pytest, requests
- **Сервер:** Uvicorn


## Часть 2: Разработка и тестирование ИИ-агента на основе LLM (Сергиенко Никита)

### 2.1 API для интеграции с LLM (Часть 3)

**Архитектура решения:**
- Использование готового Ollama API как базового решения
- Реализация HTTP-клиента для взаимодействия с локальной LLM
- Организация модульной структуры для легкой замены модели

**Ключевые компоненты реализации:**
```python
# Базовый API клиент для Ollama
def query_llama(prompt, model="llama3.1:8b"):
    payload = {
        "model": model,
        "prompt": prompt,
        "stream": False
    }
    response = requests.post(API_URL, json=payload)
    return json.loads(response.text)['response']
```

### 2.2 Сравнительное тестирование легковесных LLM (Часть 4)

**Протестированные модели:**
- Llama3.1:8b
- DeepSeek-R1:7b

**Методология тестирования:**
- Разработка комплексного тестового набора из 5 категорий вопросов
- Измерение времени ответа для каждой модели
- Оценка точности, склонности к галлюцинациям и соответствия инструкциям

**Результаты тестирования:**
- **Llama3.1:8b**: 57% точности, среднее время ответа 2.15с
- **DeepSeek-R1:7b**: 79% точности, среднее время ответа 28.71с

### 2.3 Обоснование выбора модели для агента

**Критерии выбора:**
1. **Производительность** - скорость ответа критична для пользовательского опыта
2. **Соответствие языку** - стабильность работы на русском языке
3. **Предсказуемость** - минимальные галлюцинации и соблюдение инструкций

**Выбранная модель: Llama3.1:8b (подробнее в \agent\test result\summary.md)** 

**Аргументация:**
- В 13 раз быстрее конкурента (2.15с vs 28.71с)
- Стабильное соблюдение языкового контекста
- Меньшая склонность к смешению языков в ответах
- Оптимальный баланс между качеством и производительностью

### 2.4 Техническое задание для погодного агента (Часть 5)

**Цель:** Автоматизация предоставления персонализированных погодных рекомендаций

**Функциональные требования:**
- Получение актуальных данных о погоде через OpenWeatherMap API
- Генерация развернутых рекомендаций по одежде и досугу
- Поддержка текущей погоды и прогноза на несколько часов вперед
- Включение всех обязательных элементов: температура, влажность, ветер, рекомендации
- Ответы должны быть точными и основанными только на данных API
- Предоставление рекомендаций по одежде и активностям
- Интерактивный режим работы

**Нефункциональные требования:**
- Время ответа < 10 секунд
- Работа на русском языке
- Обработка ошибок подключения к внешним API

### 2.5 Реализация ИИ-агента

**Архитектура:**
1. **Получение данных о погоде** через OpenWeatherMap API
   - Поддержка текущей погоды и прогноза до 5 дней
   - Автоматический подбор ближайшего временного интервала для прогноза

2. **Обработка запросов** через локальную LLM (Ollama)
   - Модель: Llama 3.1 8B
   - Специализированный system prompt на русском языке

**Ключевые функции:**
- `get_weather_data()` - получение и обработка данных с API
- `ask_llm()` - взаимодействие с языковой моделью

**Особенности ответов:**
- Температура с округлением
- Рекомендации по одежде и активностям
- Учет реальных погодных условий
- Только проверенные данные из API

**Интерфейс:**
- Консольный ввод города и временного горизонта
- Обработка ошибок и валидация ввода
- Читаемое форматирование вывода

### 2.6 Метрики оценки моделей

**Производительность:**
- Среднее время ответа (с)
- Время обработки первого токена
- Пропускная способность (токенов/секунду)

**Качество ответов:**
- Фактическая точность (% правильных ответов)
- Соответствие инструкциям
- Отсутствие галлюцинаций
- Языковая согласованность
- Соответствие формату ответа

**Эффективность ресурсов:**
- Использование оперативной памяти
- Загрузка процессора
- Энергопотребление

### 2.7 Анализ уязвимостей и пути их разрешения

**Выявленные уязвимости:**

**1. Уязвимость API ключа**
- Риск: Ключ OpenWeatherMap хранится в открытом виде
- Решение: Перенос в переменные окружения, использование secret manager

**2. Инъекции промпта**
- Риск: Возможность манипуляции системным промптом
- Решение: Валидация входных данных, экранирование специальных символов

**3. Ограничения бесплатного API**
- Риск: Исчерпание лимитов запросов
- Решение: Кэширование, резервные API провайдеры

**4. Неконтролируемые рекомендации**
- Риск: LLM может генерировать неподходящие советы
- Решение: Контрольные списки разрешенных рекомендаций, пост-обработка  

**5. Отсутствие мониторинга**
- Риск: Невозможно отслеживать сбои
- Решение: Добавление логирования, метрик здоровья системы

**6. Зависимость от внешних API**
- Риск: Отказ сервиса OpenWeatherMap
- Решение: Кэширование данных, резервные источники

**7. Ошибки ввода пользователя**
- Риск: Некорректные названия городов
- Решение: Валидация ввода, автодополнение городов